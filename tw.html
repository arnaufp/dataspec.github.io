<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>Trade Waste â€“ EspecificaciÃ³ de dades</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { overflow-x: hidden; }
    .sidebar {
      height: 100vh;
      position: fixed;
      width: 260px;
    }
    .content {
      margin-left: 270px;
      padding: 2rem;
    }
    .table-name { font-family: monospace; }
    .badge-fk { background-color: #6f42c1; }
  </style>
</head>
<body class="bg-light">

<!-- Sidebar -->
<div class="sidebar bg-dark text-white p-3">
  <h5 class="mb-3">ðŸ“Š Data Model</h5>
  <ul class="nav nav-pills flex-column" id="tableNav"></ul>
</div>

<!-- Content -->
<div class="content">
  <div id="tableContent"></div>
</div>

<!-- jQuery + Bootstrap -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// ==============================
// DATA SPECIFICATION (JS OBJECT)
// ==============================
const dataModel = {
  customer: {
    name: 'Customer', description: 'Master table for trade waste customers.',
    fields: [
      { name: 'id', type: 'UUID', required: true, unique: true, remarks: 'Primary identifier' },
      { name: 'account_number', type: 'String', required: true, unique: true, min:1, max:20, remarks:'Provided by council' },
      { name: 'name', type: 'String', required: true, min:1, max:255 },
      { name: 'email', type: 'Email', required: false, max:255 },
      { name: 'status', type: 'Lookup', required:true, lookup:'CustomerStatus', acceptedValues:'CustomerStatus', remarks:'Lifecycle status' }
    ]
  },
  address: {
    name:'Address', description:'Addresses linked to a customer.',
    fields:[
      { name:'id', type:'UUID', required:true },
      { name:'customer_id', type:'UUID', required:true, fk:'Customer.id', remarks:'Owning customer' },
      { name:'line1', type:'String', required:true },
      { name:'city', type:'String', required:true },
      { name:'postcode', type:'String', required:false }
    ]
  },
  service: {
    name:'Service', description:'Waste collection service provided to a customer.',
    fields:[
      { name:'id', type:'UUID', required:true, unique:true },
      { name:'customer_id', type:'UUID', required:true, fk:'Customer.id', remarks:'Owning customer' },
      { name:'container_type', type:'Lookup', required:true, lookup:'ContainerType', acceptedValues:'ContainerType' },
      { name:'collection_frequency', type:'Lookup', required:true, lookup:'CollectionFrequency', acceptedValues:'CollectionFrequency' },
      { name:'collection_day', type:'Lookup', required:true, lookup:'CollectionDay', acceptedValues:'CollectionDay' }
    ]
  },
  collection: {
    name:'Collection', description:'Actual collection events generated from services.',
    fields:[
      { name:'id', type:'UUID', required:true },
      { name:'service_id', type:'UUID', required:true, fk:'Service.id' },
      { name:'collection_date', type:'Date', required:true },
      { name:'status', type:'Lookup', required:true, lookup:'CollectionStatus', acceptedValues:'CollectionStatus' }
    ]
  },
  invoice: {
    name:'Invoice', description:'Invoices issued to customers.',
    fields:[
      { name:'id', type:'UUID', required:true, unique:true },
      { name:'customer_id', type:'UUID', required:true, fk:'Customer.id' },
      { name:'invoice_date', type:'Date', required:true },
      { name:'total_amount', type:'Decimal', required:true, min:0, max:999999, decimals:2, remarks:'Amount excluding tax' }
    ]
  },
  lookups: {
    name:'Lookups', description:'Lookup / reference tables.',
    fields:[
      { name:'CustomerStatus', values:['ACTIVE','SUSPENDED','CLOSED'] },
      { name:'ContainerType', values:['240L','660L','1100L'] },
      { name:'CollectionFrequency', values:['WEEKLY','FORTNIGHTLY'] },
      { name:'CollectionDay', values:['MONDAY','TUESDAY','WEDNESDAY','THURSDAY','FRIDAY'] },
      { name:'CollectionStatus', values:['SCHEDULED','COMPLETED','MISSED'] }
    ]
  }
};

// ==============================
// SIDEBAR GENERATION
// ==============================
function renderSidebar(){
  let html='';
  Object.keys(dataModel).forEach(key=>{
    html+=`<li class="nav-item"><a class="nav-link ${key==='customer'?'active':''}" data-table="${key}" href="#">${dataModel[key].name}</a></li>`;
  });
  $('#tableNav').html(html);
}

// ==============================
// RENDER TABLE
// ==============================
function renderTable(key){
  const table = dataModel[key];
  let html=`<h2 class="table-name">${table.name}</h2><p class="text-muted">${table.description}</p>`;
  if(key==='lookups'){
    table.fields.forEach(l=>{
      html+=`<div class="card mb-3"><div class="card-body"><h5>${l.name}</h5>${l.values.map(v=>`<span class="badge bg-secondary me-1">${v}</span>`).join('')}</div></div>`;
    });
  } else {
    html+=`<table class="table table-bordered table-sm bg-white"><thead class="table-light"><tr><th>Attribute</th><th>Type</th><th>Required</th><th>Unique</th><th>Min</th><th>Max</th><th>Decimals</th><th>Accepted Values</th><th>Remarks</th></tr></thead><tbody>`;
    table.fields.forEach(f=>{
      html+=`<tr>
<td><code>${f.name}</code></td>
<td>${f.type||''}</td>
<td>${f.required?'âœ…':''}</td>
<td>${f.unique?'âœ…':''}</td>
<td>${f.min??''}</td>
<td>${f.max??''}</td>
<td>${f.decimals??''}</td>
<td>${f.acceptedValues?`<a href="#" class="badge bg-secondary lookup-link" data-lookup="${f.acceptedValues}">${f.acceptedValues}</a>`:''}</td>
<td>${f.fk?`FK â†’ <a href="#" class="fk-link" data-target="${f.fk.split('.')[0].toLowerCase()}">${f.fk}</a>`:f.remarks||''}</td>
</tr>`;
    });
    html+='</tbody></table>';
  }
  $('#tableContent').html(html);
}

// ==============================
// NAVIGATION HANDLERS
// ==============================
$(document).on('click','#tableNav a',function(e){
  e.preventDefault();
  $('#tableNav a').removeClass('active');
  $(this).addClass('active');
  renderTable($(this).data('table'));
});

$(document).on('click','.fk-link',function(e){
  e.preventDefault();
  const target=$(this).data('target');
  $('#tableNav a').removeClass('active');
  $(`#tableNav a[data-table="${target}"]`).addClass('active');
  renderTable(target);
});

$(document).on('click','.lookup-link',function(e){
  e.preventDefault();
  $('#tableNav a').removeClass('active');
  $('#tableNav a[data-table="lookups"]').addClass('active');
  renderTable('lookups');
});

// INITIAL LOAD
renderSidebar();
renderTable('customer');
</script>

</body>
</html>
